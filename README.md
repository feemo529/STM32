# TIM输入捕获

## 频率测量

![image-20230321220055130](D:\江科STM32\images\image-20230321220055130.png)



# TIM编码器接口

## 编码器接口简介

- Encoder Interface 编码器接口
- 编码器接口可接收增量（正交）编码器的信号，根据编码器旋转产生的正交信号脉冲，自动控制CNT自增或自减，从而指示编码器的位置、旋转方向和旋转速度
- 每个高级定时器和通用定时器都拥有1个编码器接口
- 两个输入引脚借用了输入捕获的通道1和通道2



## 正交编码器

![image-20230321220055130](D:\江科STM32\images\image-20230321220055130.png)

## 工作模式

![image-20230323223528373](D:\江科STM32\images\image-20230323223528373.png)



## 实例（均不反相）

![image-20230323223555983](D:\江科STM32\images\image-20230323223555983.png)



# ADC模数转换器

## ADC简介

- ADC（Analog-Digital Converter）模拟-数字转换器
- ADC可以将引脚上连续变化的模拟电压转换为内存中存储的数字变量，建立模拟电路到数字电路的桥梁
- 12位逐次逼近型ADC，1us转换时间
- 输入电压范围：0~3.3V，转换结果范围：0~4095
- 18个输入通道，可测量16个外部和2个内部信号源
- 规则组和注入组两个转换单元
- 模拟看门狗自动监测输入电压范围
- STM32F103C8T6 ADC资源：ADC1、ADC2，10个外部输入通道



## 逐次逼近型ADC

![image-20230325221829555](D:\江科STM32\images\image-20230325221829555.png)



## ADC框图

![image-20230325222740473](D:\江科STM32\images\image-20230325222740473.png)



## ADC基本结构

![image-20230325223639938](D:\江科STM32\images\image-20230325223639938.png)



## 输入通道

![image-20230325223947684](D:\江科STM32\images\image-20230325223947684.png)



## 转换模式

![image-20230325224017308](D:\江科STM32\images\image-20230325224017308.png)

![image-20230325224118195](D:\江科STM32\images\image-20230325224118195.png)

![image-20230325224158247](D:\江科STM32\images\image-20230325224158247.png)

![image-20230325224208384](D:\江科STM32\images\image-20230325224208384.png)



## 触发控制

![image-20230325224544573](D:\江科STM32\images\image-20230325224544573.png)



## 数据对齐

- **数据右对齐:**

  ![image-20230325224700305](D:\江科STM32\images\image-20230325224700305.png)

- **数据左对齐：**

  ![image-20230325224724270](D:\江科STM32\images\image-20230325224724270.png)



## 转换时间

- AD转换的步骤：采样，保持，量化，编码

  

- STM32 ADC的总转换时间为：

   	TCONV = 采样时间 + 12.5个ADC周期

  

- 例如：当ADCCLK=14MHz，采样时间为1.5个ADC周期

   	TCONV = 1.5 + 12.5 = 14个ADC周期 = 1μs



## 校准

- ADC有一个内置自校准模式。校准可大幅减小因内部电容器组的变化而造成的准精度误差。校准期间，在每个电容器上都会计算出一个误差修正码(数字值)，这个码用于消除在随后的转换中每个电容器上产生的误差

  

- 建议在每次上电后执行一次校准

  

- 启动校准前， ADC必须处于关电状态超过至少两个ADC时钟周期



## 硬件电路

![image-20230325230245880](D:\江科STM32\images\image-20230325230245880.png)



# DMA直接存储器存取

## DMA简介

- DMA（Direct Memory Access）直接存储器存取

- DMA可以提供外设和存储器或者存储器和存储器之间的高速数据传输，无须CPU干预，节省了CPU的资源

- 12个独立可配置的通道： DMA1（7个通道）， DMA2（5个通道）

- 每个通道都支持软件触发和特定的硬件触发

  

- STM32F103C8T6 DMA资源：DMA1（7个通道）



## 存储器映像

![image-20230326175520040](D:\江科STM32\images\image-20230326175520040.png)



## DMA框图

![image-20230326180420784](D:\江科STM32\images\image-20230326180420784.png)



## DMA基本结构

![image-20230326181926400](D:\江科STM32\images\image-20230326181926400.png)



## DMA请求

![image-20230326183540142](D:\江科STM32\images\image-20230326183540142.png)



## 数据宽度与对齐

![image-20230326183604400](D:\江科STM32\images\image-20230326183604400.png)



## 数据转运+DMA

![image-20230326183626899](D:\江科STM32\images\image-20230326183626899.png)

## ADC扫描模式+DMA

![image-20230326183709188](D:\江科STM32\images\image-20230326183709188.png)





# USART串口协议

## 通信接口

- 通信的目的：将一个设备的数据传送到另一个设备，扩展硬件系统
- 通信协议：制定通信的规则，通信双方按照协议规则进行数据收发

![image-20230326183802257](D:\江科STM32\images\image-20230326183802257.png)



## 串口通信

- 串口是一种应用十分广泛的通讯接口，串口成本低、容易使用、通信线路简单，可实现两个设备的互相通信
- 单片机的串口可以使单片机与单片机、单片机与电脑、单片机与各式各样的模块互相通信，极大地扩展了单片机的应用范围，增强了单片机系统的硬件实力



## 硬件电路

- 简单双向串口通信有两根通信线（发送端TX和接收端RX）
- TX与RX要交叉连接
- 当只需单向的数据传输时，可以只接一根通信线
- 当电平标准不一致时，需要加电平转换芯片

![image-20230326221457689](D:\江科STM32\images\image-20230326221457689.png)



## 电平标准

- 电平标准是数据1和数据0的表达方式，是传输线缆中人为规定的电压与数据的对应关系，串口常用的电平标准有如下三种：

  

- TTL电平：+3.3V或+5V表示1，0V表示0

- RS232电平：-3~-15V表示1，+3~+15V表示0

- RS485电平：两线压差+2~+6V表示1，-2~-6V表示0（差分信号）



## 串口参数及时序

- 波特率：串口通信的速率
- 起始位：标志一个数据帧的开始，固定为低电平
- 数据位：数据帧的有效载荷，1为高电平，0为低电平，低位先行
- 校验位：用于数据验证，根据数据位计算得来
- 停止位：用于数据帧间隔，固定为高电平

![image-20230326221917763](D:\江科STM32\images\image-20230326221917763.png)

## 串口时序

![image-20230326223804585](D:\江科STM32\images\image-20230326223804585.png)



## USART串口外设

- USART（Universal Synchronous/Asynchronous Receiver/Transmitter）通用同步/异步收发器
- USART是STM32内部集成的硬件外设，可根据数据寄存器的一个字节数据自动生成数据帧时序，从TX引脚发送出去，也可自动接收RX引脚的数据帧时序，拼接为一个字节数据，存放在数据寄存器里
- 自带波特率发生器，最高达4.5Mbits/s
- 可配置数据位长度（8/9）、停止位长度（0.5/1/1.5/2）
- 可选校验位（无校验/奇校验/偶校验）
- 支持同步模式、硬件流控制、DMA、智能卡、IrDA、LIN
- 
- STM32F103C8T6 USART资源： USART1、 USART2、 USART3



## USART框图

![image-20230326224802073](D:\江科STM32\images\image-20230326224802073.png)



## USART基本结构

![image-20230326230000429](D:\江科STM32\images\image-20230326230000429.png)



## 数据帧

![image-20230326230045347](D:\江科STM32\images\image-20230326230045347.png)

![image-20230326230056102](D:\江科STM32\images\image-20230326230056102.png)



## 起始位侦测

![image-20230326230119763](D:\江科STM32\images\image-20230326230119763.png)



## 数据采样

![image-20230326230133369](D:\江科STM32\images\image-20230326230133369.png)



## 波特率发生器

- 发送器和接收器的波特率由波特率寄存器BRR里的DIV确定
- 计算公式：波特率 = fPCLK2/1 / (16 * DIV)

![image-20230326230536279](D:\江科STM32\images\image-20230326230536279.png)



## 数据模式

- HEX模式/十六进制模式/二进制模式：以原始数据的形式显示
- 文本模式/字符模式：以原始数据编码后的形式显示

![image-20230326230611818](.\images\image-20230326230611818.png)

![image-20230326230619126](D:\江科STM32\images\image-20230326230619126.png)



## HEX数据包

![image-20230326230632888](D:\江科STM32\images\image-20230326230632888.png)



## 文本数据包

![image-20230326230648345](D:\江科STM32\images\image-20230326230648345.png)



## HEX数据包接收

![image-20230401154902282](D:\江科STM32\images\image-20230401154902282.png)



## 文本数据包接收

![image-20230401155001537](D:\江科STM32\images\image-20230401155001537.png)
